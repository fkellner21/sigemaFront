<div class="titulo text-center my-1">Listado de mantenimientos</div>

<div class="row me-0">
    <!-- Filtros de fecha -->
    <div class="row pe-0 mb-3">
        <div class="col-md-3">
            <mat-form-field class="w-100">
                <mat-label>Fecha desde</mat-label>
                <input 
                    matInput 
                    [matDatepicker]="pickerDesde" 
                    [(ngModel)]="fechaDesde"
                    (dateChange)="aplicarFiltro()"
                    readonly
                >
                <mat-datepicker-toggle matSuffix [for]="pickerDesde"></mat-datepicker-toggle>
                <mat-datepicker #pickerDesde></mat-datepicker>
            </mat-form-field>
        </div>
        
        <div class="col-md-3">
            <mat-form-field class="w-100">
                <mat-label>Fecha hasta</mat-label>
                <input 
                    matInput 
                    [matDatepicker]="pickerHasta" 
                    [(ngModel)]="fechaHasta"
                    (dateChange)="aplicarFiltro()"
                    readonly
                >
                <mat-datepicker-toggle matSuffix [for]="pickerHasta"></mat-datepicker-toggle>
                <mat-datepicker #pickerHasta></mat-datepicker>
            </mat-form-field>
        </div>

        <!-- <div class="col-md-3 d-flex align-items-center">
            <button 
                class="btn btn-secondary" 
                (click)="limpiarFiltros()"
                [disabled]="isLoading"
            >
                <i class="bi bi-arrow-clockwise me-1"></i>
                Limpiar
            </button>
        </div> -->

        <div class="col-md-3 text-end">
            <button class="btn btn-dark">
                <i class="bi bi-plus me-1"></i>
                Nuevo mantenimiento
            </button>
        </div>
    </div>

    <div>
        <table
            mat-table
            [dataSource]="dataSource"
            class="mat-elevation-z8 table table-striped table-hover"
        >
            <ng-container matColumnDef="fecha">
                <th mat-header-cell *matHeaderCellDef class="bg-dark text-white">
                    Fecha
                </th>
                <td mat-cell *matCellDef="let m">
                    {{ m.fechaMantenimiento | date:'dd/MM/yyyy' }}
                </td>
            </ng-container>

            <ng-container matColumnDef="vehiculo">
                <th mat-header-cell *matHeaderCellDef class="bg-dark text-white">
                    Equipo
                </th>
                <td mat-cell *matCellDef="let m">
                    {{ m.equipo?.matricula || m.equipo?.nombre || "Sin equipo" }}
                </td>
            </ng-container>

            <ng-container matColumnDef="detalle">
                <th mat-header-cell *matHeaderCellDef class="bg-dark text-white">
                    Detalle
                </th>
                <td mat-cell *matCellDef="let m">{{ m.descripcion }}</td>
            </ng-container>

            <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef class="bg-dark text-white text-center">
                    Acciones
                </th>
                <td mat-cell *matCellDef="let m" class="text-center">
                    <button class="btn btn-dark btn-sm me-2" title="Editar">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button
                        class="btn btn-danger btn-sm"
                        (click)="eliminarMantenimiento(m.id)"
                        title="Eliminar"
                        [disabled]="isLoading"
                    >
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" [attr.colspan]="displayedColumns.length" class="text-center py-4">
                    <div *ngIf="!isLoading">
                        <i class="bi bi-info-circle me-2"></i>
                        No se encontraron mantenimientos en el rango de fechas seleccionado
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>

<div class="text-center my-3" *ngIf="isLoading">
    <div class="spinner-border text-dark" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Buscando mantenimientos...</p>
</div>
